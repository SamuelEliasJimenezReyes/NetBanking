@using Microsoft.JSInterop;
@using NetBanking.Core.Application.Dtos.Account;
@using NetBanking.Core.Application.Dtos.User;
@using NetBanking.Core.Application.Helpers;
@inject IHttpContextAccessor httpContextAccessor
@model List<UserDTO>

@{
    ViewData["Title"] = "Home";
    var userInSession = httpContextAccessor.HttpContext.Session.Get<AuthenticationResponse>("user");
    string filter = "Admin";
    string userType = "";
}
@{
    filter = ViewBag.Filter != null ? ViewBag.Filter : "Admin";
    userType = filter == "Admin" ? "Admin" : "Client";

    string adminUrlWithParam = Url.Action("UpdateFilter", "Admin", new { newFilter = "Client"});
    string clientUrlWithParam = Url.Action("UpdateFilter", "Admin", new { newFilter = "Admin" });

}


<section>
    <div class="container mt-2">
        <div class="row">
            <div class="col-10 offset-1">
                <h2 class="bg-primary text-center">Users</h2>
                <div class="col-4">
                    <select class="form-control mt-2 col-4" name="newFilter" id="filterSelect" onchange="updateFilter()">
                        <option value="">@userType</option>
                        <option value="@adminUrlWithParam">Admins</option>
                        <option value="@clientUrlWithParam">Clients</option>
                    </select>
                </div>
                <table class="table mt-2">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Name</th>
                            <th>Last Name</th>
                            <th>Email</th>
                            <th>Cedula</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Count() > 0)
                        {
                            @foreach (var user in Model.Where(x => x.Roles.Contains(filter)))
                            {
                                <tr>
                                    <td>@user.UserName</td>
                                    <td>@user.FirstName</td>
                                    <td>@user.LastName</td>
                                    <td>@user.Email</td>
                                    <td>@user.Cedula</td>
                                    <td>
                                        @if (user.UserName != userInSession.UserName && user.UserName != "mingo")
                                        { 
                                        @if (user.IsActive)
                                        {
                                            <a asp-controller="Admin" asp-action="ChangeUserStatus" asp-route-userName="@user.UserName" class="btn-sm btn-outline-danger">Inactivar</a>
                                        }
                                        else
                                        {
                                            <a asp-controller="Admin" asp-action="ChangeUserStatus" asp-route-userName="@user.UserName" class="btn-sm btn-outline-success">Activar</a>
                                        }
                                        }
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<script>
    function updateFilter() {
        var filterSelect = document.getElementById('filterSelect');
        var selectedValue = filterSelect.options[filterSelect.selectedIndex].value;
        window.location.href = selectedValue; 
    }
</script>



